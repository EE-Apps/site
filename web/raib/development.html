<!DOCTYPE html>
<html>
<head>
<title>Write Messages</title>
<style>
body {
    font-family: Arial, sans-serif;
    max-width: 600px;
    margin: 20px auto;
    padding: 20px;
    background-color: #333;
    color: white;
}
.form-group { margin-bottom: 15px; }
label { display: block; margin-bottom: 5px; }
input, textarea, select {
    width: 100%;
    padding: 8px;
    margin-bottom: 10px;
    background: #222;
    color: white;
    border: 1px solid #555;
    border-radius: 4px;
}
button {
    padding: 8px 15px;
    border: none;
    cursor: pointer;
    color: white;
    border-radius: 4px;
    background-color: #4CAF50;
}
button:hover {
    background-color: #45a049;
}
</style>
<script>
/* ================= WEBHOOK ================= */
const WEBHOOK_NAMES = {};
const DEFAULT_NAME = "System";
const STORAGE_KEY = "discord_webhook_url";

/* ================= PROFILES ================= */
const ANON_PROFILES = {
    soft:   { max: 18, dropPunct: 0.4, removePronouns: false, scramble: 0.05 },
    medium: { max: 12, dropPunct: 0.7, removePronouns: true, scramble: 0.12 },
    hard:   { max: 8,  dropPunct: 0.95, removePronouns: true, scramble: 0.25 }
};
let CURRENT_PROFILE = "medium";

/* ================= REGEX ================= */
const ARTICLES = /\b(a|an|the)\b/gi;
const PRONOUNS = /\b(i|we|you|he|she|they|me|us|him|her|them|my|our|your|his|its|their|myself|yourself|himself|herself|themselves)\b/gi;
const NUMBERS = /\b\d+(\.\d+)?%?\b/g;
const MENTIONS = /@[\w\s-]+/g;
const EMOTIONS = /[!?â€¦]{2,}/g;
const ROLES = '';
const LOCATIONS = '';
const ORGS = '';

/* ================= INIT ================= */
window.onload = () => {
    const saved = localStorage.getItem(STORAGE_KEY);
    if (saved) document.getElementById("webhook").value = saved;
};

/* ================= ANON ================= */
function anonymizeText(text) {
    const cfg = ANON_PROFILES[CURRENT_PROFILE];
    let t = text.toLowerCase()
        .replace(/\r?\n+/g, ' ')
        .replace(/[,;:"'()[\]]/g, '')
        .replace(MENTIONS, 'entity')
        .replace(LOCATIONS, 'location')
        .replace(ORGS, 'organization')
        .replace(ROLES, 'office')
        .replace(NUMBERS, 'value')
        .replace(EMOTIONS, '')
        .replace(ARTICLES, '')
        .replace(/\s{2,}/g, ' ')
        .trim();
    
    if (cfg.removePronouns) {
        t = t.replace(PRONOUNS, '');
    }
    
    let words = t.split(/\s+/).filter(w => w.length > 0);
    
    // Word scrambling for higher anonymization
    if (cfg.scramble > 0) {
        for (let i = words.length - 1; i > 0; i--) {
            if (Math.random() < cfg.scramble) {
                const j = Math.floor(Math.random() * (i + 1));
                [words[i], words[j]] = [words[j], words[i]];
            }
        }
    }
    
    let out = [];
    while (words.length) {
        let chunk = words.splice(0, cfg.max).join(' ');
        if (chunk.trim()) out.push(chunk.trim());
    }
    
    return out.map(s => {
        if (Math.random() >= cfg.dropPunct) return s + '.';
        return s;
    }).join(' ').replace(/\s{2,}/g, ' ').trim();
}

/* ================= SEND ================= */
function send() {
    const webhook = document.getElementById("webhook").value.trim();
    const raw = document.getElementById("message").value;
    if (!webhook || !raw.trim()) {
        alert("Webhook and message are required");
        return;
    }
    const msg = anonymizeText(raw);
    fetch(webhook, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            content: msg,
            username: DEFAULT_NAME
        })
    })
    .then(res => {
        console.log("Sent:", res.status);
        document.getElementById("message").value = "";
    })
    .catch(console.error);
}
</script>
</head>
<body>
<h2>Write Messages</h2>
<div class="form-group">
    <label>Webhook URL</label>
    <input id="webhook" type="text" placeholder="https://discord.com/api/webhooks/..." oninput="localStorage.setItem('discord_webhook_url', this.value)">
</div>
<div class="form-group">
    <label>Anonymization Profile</label>
    <select onchange="CURRENT_PROFILE=this.value">
        <option value="soft">Soft</option>
        <option value="medium" selected>Medium</option>
        <option value="hard">Hard</option>
    </select>
</div>
<div class="form-group">
    <label>Message</label>
    <textarea id="message" rows="6" placeholder="Enter your message here..."></textarea>
</div>
<button onclick="send()">Send Message</button>
</body>
</html>